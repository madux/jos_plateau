<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record model="ir.ui.view" id="memo_model_form_view_plateau_addons">
            <field name="name">memo view inherited for plateau state addons</field>
            <field name="model">memo.model</field>
            <field name="inherit_id" ref="company_memo.memo_model_form_view_3"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='print_po']" position="before">
                        <button name="generate_bank_schedule" string="Send &amp; Print Bank Schedule" icon="fa-print"
                        invisible="state not in ['Approve', 'Approve2', 'Done', 'done'] or is_contract_memo_request != True" type="object" class="btn-primary"/>
                </xpath> 
                <xpath expr="//field[@name='currency_id']" position="before">
                    <field name="partner_id" string="Partner" readonly="1" invisible="1" required="0"
                    options="{&quot;no_open&quot;: True, &quot;no_create&quot;: True}" force_save="1"/> 
                    <field name="branch_id" string="Initiator MDA" invisible="0" readonly="1" required="1"
                    options="{&quot;no_open&quot;: True, &quot;no_create&quot;: True}"/> 
                    <field name="request_mda_from" string="Requesting From MDA" 
                    invisible="external_memo_request == False" readonly="0" required="external_memo_request == True"
                    options="{&quot;no_open&quot;: True, &quot;no_create&quot;: True}"/> 
                    <field name="request_mda_from" string="Requesting From MDA" 
                        invisible="is_budget_allocation_request == False" required="is_budget_allocation_request == True"
                        readonly="state not in ['submit']" options="{&quot;no_open&quot;: True, &quot;no_create&quot;: True}"/> 
                        
                    <field name="bank_partner_id" required="is_contract_memo_request == True" invisible="state not in ['Approve', 'Approve2', 'Done'] or is_contract_memo_request == False"/> 

                    <field name="external_memo_request" invisible="1"/>
                    <field name="is_internal_transfer" invisible="1"/>
                    <field name="is_top_account_user" invisible="1"/>
                    <field name="is_budget_verification_memo_request" invisible="1"/>
                </xpath> 
                <xpath expr="//field[@name='invoice_ids']" position="attributes">
                    <attribute name="context">{'default_move_type': 'in_invoice', 'default_memo_id': active_id,'default_partner_id': partner_id, 'form_view_ref': 'account.view_move_form'}</attribute>
                </xpath>

                <xpath expr="//field[@name='payment_ids']" position="attributes">
                    <attribute name="context">{'default_request_mda_from': request_mda_from}</attribute>
                </xpath>

                <!-- 'default_external_memo_request': True, -->
                <xpath expr="//field[@name='journal_id']" position="attributes">
                    <attribute name="options">{&quot;no_open&quot;: True, &quot;no_create&quot;: True}</attribute>
                </xpath>
                <!-- <xpath expr="//field[@name='payment_ids']/form/sheet/group[@name='group2']/field[@name='journal_id']" position="replace"> -->
                <xpath expr="//field[@name='payment_ids']/form/sheet/group/group[@name='group1']/field[@name='external_memo_request']" position="after">
                    <field name="is_top_account_user" invisible="1"/> 
                </xpath>
                <xpath expr="//field[@name='payment_ids']/form/sheet/group/group[@name='group2']/field[@name='journal_id']" position="after">
                    <field name="journal_id" domain="[('id', 'in', available_journal_ids)]" 
                    invisible="is_top_account_user == False" readonly="state != 'draft'"
                        options="{&quot;no_open&quot;: True, &quot;no_create&quot;: True}"
                    string="Source Journal"/>
                    <field name="request_mda_from" invisible="0" required="external_memo_request == True"/> 
                </xpath>
                <xpath expr="//field[@name='invoice_ids']" position="attributes">
                    <!-- <attribute name="context">{'default_move_type': 'in_invoice', 'default_memo_id': active_id,  'default_branch_id': branch_id, 'form_view_ref': 'account.view_move_form'}</attribute>  -->
                    <attribute name="context">{'default_move_type': 'in_invoice', 'default_memo_id': active_id, 'form_view_ref': 'account.view_move_form'}</attribute> 
                </xpath> 
                <xpath expr="//field[@name='payment_ids']" position="attributes">
                    <attribute name="readonly">
                    "state in ['Sent', 'Done', 'Approve2'] and is_top_account_user == False"
                    </attribute> 
                </xpath> 
            </field>
        </record>

        <record model="ir.actions.act_window" id="internal_memo_model_mda_action">
            <field name="name">MDA Payment Requests</field>
            <field name="res_model">memo.model</field>
            <field name="type">ir.actions.act_window</field>
           <field name="domain">[('external_memo_request','=',True)]</field>
            <field name="context">{'default_external_memo_request': True, 'default_is_internal_transfer': False}</field>
             <field name="view_mode">tree,form</field>
        </record>
        <record model="ir.actions.act_window" id="internal_memo_model_internal_mda_action">
            <field name="name">Internal MDA Payment Request</field>
            <field name="res_model">memo.model</field>
            <field name="type">ir.actions.act_window</field>
           <field name="domain">[('is_internal_transfer','=', True)]</field>
            <field name="context">{'default_external_memo_request': False, 'default_is_internal_transfer': True}</field>
             <field name="view_mode">tree,form</field>
        </record>

        <record model="ir.actions.act_window" id="internal_memo_model_internal_contract_payment_action">
            <field name="name">Contract Payment Process</field>
            <field name="res_model">memo.model</field>
            <field name="type">ir.actions.act_window</field>
           <field name="domain">[('is_contract_memo_request','=', True)]</field>
            <field name="context">{'default_is_contract_memo_request': True}</field>
             <field name="view_mode">tree,form</field>
        </record>

        <record model="ir.actions.act_window" id="internal_memo_budget_verification_action">
            <field name="name">Budget Verification Process</field>
            <field name="res_model">memo.model</field>
            <field name="type">ir.actions.act_window</field>
           <field name="domain">[('is_budget_verification_memo_request','=', True)]</field>
            <field name="context">{'default_is_budget_verification_memo_request': True}</field>
             <field name="view_mode">tree,form</field>
        </record>

        <record model="ir.actions.act_window" id="internal_memo_budget_allocation_action">
            <field name="name">Budget Allocation Process</field>
            <field name="res_model">memo.model</field>
            <field name="type">ir.actions.act_window</field>
           <field name="domain">[('is_budget_allocation_request','=', True)]</field>
            <field name="context">{'default_is_budget_allocation_request': True}</field>
             <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="internal_memo_mda_main_menu_model" name="Finance Payments"
            parent="company_memo.internal_memo_menu_model_main2" sequence="6"/>
            <menuitem id="internal_memo_menu_mda_request" sequence= "1" name="MDA Payment Requests"
            parent="internal_memo_mda_main_menu_model" action="internal_memo_model_mda_action"/>

            <menuitem id="internal_memo_menu_internal_mda_request" sequence= "2" name="MDA Expense Payment"
            parent="internal_memo_mda_main_menu_model" action="internal_memo_model_internal_mda_action"/>

            <menuitem id="internal_memo_menu_internal_contract_payment_request" sequence= "3" name="Contract Payment Request"
            parent="internal_memo_mda_main_menu_model" action="internal_memo_model_internal_contract_payment_action"/>

            <menuitem id="internal_memo_budget_verification_menu" sequence= "4" name="Budget Verification"
            parent="internal_memo_mda_main_menu_model" action="internal_memo_budget_verification_action"/>

            <menuitem id="internal_memo_budget_allocation_menu" sequence= "5" name="Budget Allocation"
            parent="internal_memo_mda_main_menu_model" action="internal_memo_budget_allocation_action"/>
    </data>
</odoo>